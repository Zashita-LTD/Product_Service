version: '3.8'

services:
  parser-service:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: parser-service
    depends_on:
      - kafka
    environment:
      # Kafka settings
      KAFKA_BOOTSTRAP_SERVERS: kafka:29092
      KAFKA_RAW_PRODUCTS_TOPIC: raw-products
      
      # Petrovich settings
      PETROVICH_BASE_URL: https://moscow.petrovich.ru
      
      # Parsing settings
      PARSING_INTERVAL_SECONDS: 21600  # 6 hours
      HEADLESS: "true"
      MAX_CONCURRENT_PAGES: 3
      MIN_DELAY_SECONDS: 1.5
      MAX_DELAY_SECONDS: 4.0
      MAX_RETRIES: 3
      MAX_PRODUCTS_PER_RUN: 10000
      
      # Proxy settings (optional)
      # PROXY_LIST: http://user:pass@proxy1:8080,http://user:pass@proxy2:8080
      
      # Logging
      LOG_LEVEL: INFO
      LOG_FORMAT: json
    
    volumes:
      # Mount proxies file if you have one
      - ./proxies.txt:/app/proxies.txt:ro
    
    networks:
      - product-service_backend
    
    restart: unless-stopped
    
    # Resource limits
    deploy:
      resources:
        limits:
          cpus: '2.0'
          memory: 4G
        reservations:
          cpus: '1.0'
          memory: 2G

networks:
  product-service_backend:
    external: true
